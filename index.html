<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8" />
  <title>Паровозик – 1-ден 10-ға дейін</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      user-select: none;
    }

    body {
      background: #222;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: #fff;
    }

    .game-wrapper {
      width: 100%;
      max-width: 1200px;
      aspect-ratio: 16 / 9;
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 0 30px rgba(0,0,0,0.7);
      background: #4b6ea8;
    }

    .game-area {
      position: relative;
      width: 100%;
      height: 100%;
      background-image: url("https://files.catbox.moe/ptxo8a.jpg");
      background-size: cover;
      background-position: center;
      touch-action: none;
    }

    .hint-bar {
      position: absolute;
      top: 8px;
      left: 50%;
      transform: translateX(-50%);
      padding: 6px 14px;
      border-radius: 999px;
      background: rgba(0,0,0,0.5);
      font-size: 14px;
      z-index: 5;
    }

    .rails-zone {
      position: absolute;
      left: 5%;
      right: 5%;
      top: 40%;
      height: 22%;
    }

    #train {
      position: absolute;
      bottom: -20px;
      left: 0;
      width: 18%;
      height: 80%;
      background-size: contain;
      background-position: center bottom;
      background-repeat: no-repeat;
      z-index: 3;
    }

    .slots-row {
      position: absolute;
      left: 14%;
      right: 0;
      bottom: 8%;
      height: 60%;
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      padding: 0 2%;
      z-index: 1;
    }

    .slot {
      position: relative;
      width: 8%;
      height: 55%;
      border-radius: 8px;
      border: 2px dashed rgba(255,255,255,0.25);
      background: rgba(0,0,0,0.15);
      transition: background 0.2s, border-color 0.2s, transform 0.2s;
    }

    .slot.correct {
      border-color: rgba(0,255,127,0.9);
      background: rgba(0,0,0,0.35);
      transform: scale(1.05);
    }

    .slot-number {
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 14px;
      color: #fff;
      text-shadow: 0 0 3px rgba(0,0,0,0.7);
    }

    .wagon {
      position: absolute;
      width: 130px;
      height: 90px;
      border-radius: 10px;
      background: linear-gradient(135deg, #ffb347, #ff7747);
      box-shadow: 0 4px 10px rgba(0,0,0,0.45);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 22px;
      color: #fff;
      text-shadow: 0 2px 4px rgba(0,0,0,0.8);
      cursor: grab;
      z-index: 4;
      transition: box-shadow 0.15s, transform 0.1s;
      touch-action: none;
    }

    .wagon:active {
      cursor: grabbing;
      transform: scale(1.05);
      box-shadow: 0 6px 14px rgba(0,0,0,0.6);
    }

    .wagon.locked {
      cursor: default;
      box-shadow: 0 3px 8px rgba(0,0,0,0.5);
      transform: none !important;
    }

    .video-overlay {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }

    .video-overlay.active {
      display: flex;
    }

    .video-wrapper {
      width: 70%;
      max-width: 800px;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 0 30px rgba(0,0,0,0.9);
      background: #000;
      position: relative;
    }

    #winVideo {
      width: 100%;
      display: block;
    }

    .win-overlay {
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at center, rgba(0,0,0,0.2), rgba(0,0,0,0.8));
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 15;
    }

    .win-overlay.active {
      display: flex;
    }

    .win-title {
      font-size: 64px;
      font-weight: 900;
      letter-spacing: 3px;
      margin-bottom: 16px;
      text-transform: uppercase;
      animation: pop 0.8s ease-out, glow 1.4s ease-in-out infinite alternate;
    }

    .win-subtitle {
      font-size: 20px;
      margin-bottom: 28px;
      opacity: 0.9;
    }

    .btn-restart {
      padding: 12px 26px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 18px;
      font-weight: 600;
      background: linear-gradient(135deg, #00d084, #00b894);
      color: #fff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.6);
      transition: transform 0.15s, box-shadow 0.15s;
    }

    .btn-restart:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.7);
    }

    .btn-restart:active {
      transform: translateY(0);
      box-shadow: 0 3px 10px rgba(0,0,0,0.6);
    }

    .firework {
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #fff;
      pointer-events: none;
      z-index: 30;
      box-shadow:
        0 0 0 0 rgba(255,255,255,0.9),
        0 0 0 0 rgba(255,255,0,0.9),
        0 0 0 0 rgba(0,255,255,0.9),
        0 0 0 0 rgba(255,0,255,0.9);
      animation: boom 0.8s ease-out forwards;
    }

    @keyframes boom {
      0% {
        transform: translate(-50%, -50%) scale(0.4);
        opacity: 1;
        box-shadow:
          0 0 0 0 rgba(255,255,255,0.9),
          0 0 0 0 rgba(255,255,0,0.9),
          0 0 0 0 rgba(0,255,255,0.9),
          0 0 0 0 rgba(255,0,255,0.9);
      }
      100% {
        transform: translate(-50%, -50%) scale(1.5);
        opacity: 0;
        box-shadow:
          0 -40px 0 0 rgba(255,255,255,0),
          35px -20px 0 0 rgba(255,255,0,0),
          -35px -20px 0 0 rgba(0,255,255,0),
          0 40px 0 0 rgba(255,0,255,0);
      }
    }

    @keyframes pop {
      0% { transform: scale(0.6); opacity: 0; }
      60% { transform: scale(1.08); opacity: 1; }
      100% { transform: scale(1); }
    }

    @keyframes glow {
      0% { text-shadow: 0 0 10px rgba(255,255,255,0.4); }
      100% { text-shadow: 0 0 25px rgba(255,255,0,0.9); }
    }

    .game-area {
      overflow: hidden;
    }
  </style>
</head>
<body>
  <div class="game-wrapper">
    <div class="game-area" id="gameArea">
      <div class="hint-bar">
        Вагондарды 1-ден 10-ға дейін дұрыс ретпен қойып көмектес!
      </div>

      <div class="rails-zone" id="railsZone">
        <div id="train"></div>
        <div class="slots-row" id="slotsRow"></div>
      </div>

      <div class="video-overlay" id="videoOverlay">
        <div class="video-wrapper">
          <video id="winVideo" preload="auto">
            <source src="https://files.catbox.moe/b3j3rh.mp4" type="video/mp4" />
            Браузер видеоны қолдамайды.
          </video>
        </div>
      </div>

      <div class="win-overlay" id="winOverlay">
        <div class="win-title">Жеңіс!!!</div>
        <div class="win-subtitle">Паровозикке барлық вагонды тауып бердік!</div>
        <button class="btn-restart" id="restartBtn">Басынан бастау</button>
      </div>
    </div>
  </div>

  <script>
    (function() {
      const NUM_WAGONS = 10;
      const wagonSize = { width: 130, height: 90 };
      const wagons = [];
      const slots = [];

      let placedCount = 0;
      let dragging = null;
      let offsetX = 0;
      let offsetY = 0;
      let activePointerId = null;

      const gameArea = document.getElementById('gameArea');
      const railsZone = document.getElementById('railsZone');
      const slotsRow = document.getElementById('slotsRow');
      const videoOverlay = document.getElementById('videoOverlay');
      const winVideo = document.getElementById('winVideo');
      const winOverlay = document.getElementById('winOverlay');
      const restartBtn = document.getElementById('restartBtn');
      const trainEl = document.getElementById('train');

      const WAGON_IMAGES = [
        "https://files.catbox.moe/v520sk.webp",
        "https://files.catbox.moe/8g4mn3.webp",
        "https://files.catbox.moe/agx2nk.webp",
        "https://files.catbox.moe/wbn5qf.webp",
        "https://files.catbox.moe/1mug31.webp",
        "https://files.catbox.moe/9ifr4t.webp",
        "https://files.catbox.moe/sd730a.webp",
        "https://files.catbox.moe/9kfv0n.webp",
        "https://files.catbox.moe/scrw9h.webp",
        "https://files.catbox.moe/vqjlzw.webp"
      ];
      const TRAIN_SAD = "https://files.catbox.moe/j825ng.webp";
      const TRAIN_HAPPY = "https://files.catbox.moe/bxs3r0.webp";

      function createSlots() {
        slotsRow.innerHTML = "";
        slots.length = 0;
        for (let i = 1; i <= NUM_WAGONS; i++) {
          const slot = document.createElement('div');
          slot.className = 'slot';
          slot.dataset.number = i;

          const label = document.createElement('div');
          label.className = 'slot-number';
          label.textContent = i;

          slot.appendChild(label);
          slotsRow.appendChild(slot);
          slots.push(slot);
        }
      }

      function createWagons() {
        for (const w of wagons) {
          if (w.element && w.element.parentNode) {
            w.element.parentNode.removeChild(w.element);
          }
        }
        wagons.length = 0;

        for (let i = 1; i <= NUM_WAGONS; i++) {
          const wagonEl = document.createElement('div');
          wagonEl.className = 'wagon';
          wagonEl.dataset.number = i;
          wagonEl.dataset.locked = "false";

          wagonEl.style.backgroundImage = `url("${WAGON_IMAGES[i - 1]}")`;
          wagonEl.style.backgroundSize = "contain";
          wagonEl.style.backgroundRepeat = "no-repeat";
          wagonEl.style.backgroundPosition = "center";

          gameArea.appendChild(wagonEl);
          wagons.push({ number: i, element: wagonEl });
        }
      }

      function randomizeWagonPositions() {
        const areaRect = gameArea.getBoundingClientRect();
        const railsRect = railsZone.getBoundingClientRect();
        const margin = 10;

        wagons.forEach(w => {
          const el = w.element;
          el.classList.remove('locked');
          el.dataset.locked = "false";

          const placeOnTop = Math.random() < 0.5;
          let x, y;

          const minX = areaRect.left + margin;
          const maxX = areaRect.right - margin - wagonSize.width;

          if (placeOnTop) {
            const minY = areaRect.top + margin;
            let maxY = railsRect.top - margin - wagonSize.height;
            if (maxY < minY) {
              maxY = minY;
            }
            y = randomBetween(minY, maxY);
          } else {
            const minY = railsRect.bottom + margin;
            let maxY = areaRect.bottom - margin - wagonSize.height;
            if (maxY < minY) {
              maxY = minY;
            }
            y = randomBetween(minY, maxY);
          }

          x = randomBetween(minX, maxX);

          const gameRect = gameArea.getBoundingClientRect();
          el.style.left = (x - gameRect.left) + "px";
          el.style.top = (y - gameRect.top) + "px";
        });
      }

      function randomBetween(min, max) {
        if (max < min) max = min;
        return Math.random() * (max - min) + min;
      }

      function initDragging() {
        gameArea.addEventListener('pointerdown', onPointerDown);
        gameArea.addEventListener('pointermove', onPointerMove);
        gameArea.addEventListener('pointerup', onPointerUp);
        gameArea.addEventListener('pointercancel', onPointerUp);
      }

      function onPointerDown(e) {
        const target = e.target.closest('.wagon');
        if (!target) return;
        if (target.dataset.locked === "true") return;

        e.preventDefault();

        dragging = target;
        activePointerId = e.pointerId;

        const rect = dragging.getBoundingClientRect();
        offsetX = e.clientX - rect.left;
        offsetY = e.clientY - rect.top;

        dragging.style.zIndex = 10;

        if (dragging.setPointerCapture) {
          dragging.setPointerCapture(activePointerId);
        }
      }

      function onPointerMove(e) {
        if (!dragging) return;
        if (e.pointerId !== activePointerId) return;

        e.preventDefault();

        const areaRect = gameArea.getBoundingClientRect();

        let newLeft = e.clientX - areaRect.left - offsetX;
        let newTop = e.clientY - areaRect.top - offsetY;

        newLeft = Math.max(0, Math.min(areaRect.width - dragging.offsetWidth, newLeft));
        newTop = Math.max(0, Math.min(areaRect.height - dragging.offsetHeight, newTop));

        dragging.style.left = newLeft + "px";
        dragging.style.top = newTop + "px";
      }

      function onPointerUp(e) {
        if (!dragging) return;
        if (e.pointerId !== activePointerId) return;

        e.preventDefault();

        if (dragging.releasePointerCapture) {
          try {
            dragging.releasePointerCapture(activePointerId);
          } catch (err) {}
        }

        const wagon = dragging;
        activePointerId = null;

        const wagonNumber = parseInt(wagon.dataset.number, 10);

        const wagonRect = wagon.getBoundingClientRect();

        for (const slot of slots) {
          const slotNumber = parseInt(slot.dataset.number, 10);
          if (slotNumber !== wagonNumber) continue;

          const slotRect = slot.getBoundingClientRect();

          const wagonCenter = {
            x: wagonRect.left + wagonRect.width / 2,
            y: wagonRect.top + wagonRect.height / 2
          };
          const slotCenter = {
            x: slotRect.left + slotRect.width / 2,
            y: slotRect.top + slotRect.height / 2
          };

          const dx = wagonCenter.x - slotCenter.x;
          const dy = wagonCenter.y - slotCenter.y;
          const distance = Math.sqrt(dx * dx + dy * dy);

          const snapRadius = Math.min(slotRect.width, slotRect.height) * 0.8;

          if (distance < snapRadius) {
            const areaRect = gameArea.getBoundingClientRect();
            const left = slotCenter.x - areaRect.left - wagonRect.width / 2;
            const top = slotCenter.y - areaRect.top - wagonRect.height / 2;

            wagon.style.left = left + "px";
            wagon.style.top = top + "px";
            wagon.dataset.locked = "true";
            wagon.classList.add('locked');
            slot.classList.add('correct');

            placedCount++;
            spawnFirework(
              slotCenter.x - areaRect.left,
              slotCenter.y - areaRect.top
            );

            if (placedCount === NUM_WAGONS) {
              onAllPlaced();
            }

            break;
          }
        }

        wagon.style.zIndex = 4;
        dragging = null;
      }

      function spawnFirework(x, y) {
        const fw = document.createElement('div');
        fw.className = 'firework';
        fw.style.left = x + "px";
        fw.style.top = y + "px";
        gameArea.appendChild(fw);

        setTimeout(() => {
          if (fw.parentNode) fw.parentNode.removeChild(fw);
        }, 900);
      }

      function onAllPlaced() {
        if (trainEl) {
          trainEl.style.backgroundImage = `url("${TRAIN_HAPPY}")`;
        }

        videoOverlay.classList.add('active');

        if (winVideo) {
          try {
            winVideo.currentTime = 0;
            winVideo.play();
          } catch (e) {}

          winVideo.onended = function() {
            videoOverlay.classList.remove('active');
            showWinOverlay();
          };
        } else {
          showWinOverlay();
        }
      }

      function showWinOverlay() {
        winOverlay.classList.add('active');

        const areaRect = gameArea.getBoundingClientRect();
        for (let i = 0; i < 8; i++) {
          setTimeout(() => {
            const x = randomBetween(areaRect.width * 0.15, areaRect.width * 0.85);
            const y = randomBetween(areaRect.height * 0.15, areaRect.height * 0.6);
            spawnFirework(x, y);
          }, i * 180);
        }
      }

      function resetGame() {
        placedCount = 0;
        winOverlay.classList.remove('active');

        slots.forEach(slot => slot.classList.remove('correct'));

        if (trainEl) {
          trainEl.style.backgroundImage = `url("${TRAIN_SAD}")`;
        }

        randomizeWagonPositions();
      }

      restartBtn.addEventListener('click', resetGame);

      window.addEventListener('load', () => {
        createSlots();
        createWagons();
        randomizeWagonPositions();
        initDragging();

        if (trainEl) {
          trainEl.style.backgroundImage = `url("${TRAIN_SAD}")`;
        }
      });

      window.addEventListener('resize', () => {
        randomizeWagonPositions();
      });
    })();
  </script>
</body>
</html>
