<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="UTF-8" />
  <title>–ü–∞—Ä–æ–≤–æ–∑–∏–∫ ‚Äì 1-–¥–µ–Ω 10-“ì–∞ –¥–µ–π—ñ–Ω</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      user-select: none;
    }

    body {
      background: #222;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      color: #fff;
    }

    .game-wrapper {
      width: 100%;
      max-width: 1200px;
      aspect-ratio: 16 / 9;
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 0 30px rgba(0,0,0,0.7);
      background: #4b6ea8;
    }

   .game-area {
      position: relative;
      width: 100%;
      height: 100%;
      /* TODO: —Å—é–¥–∞ –ø–æ—Å—Ç–∞–≤—å —Ñ–æ–Ω —Å —Ä–µ–ª—å—Å–∞–º–∏ */
      background-image: url("https://files.catbox.moe/4dx8jm.jpg");
      background-size: cover;
      background-position: center;
      touch-action: none; /* <- –í–ê–ñ–ù–û –î–õ–Ø –ü–õ–ê–ù–®–ï–¢–ê */
    }


    /* –ü–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–∞—è –ø–æ–¥—Å–∫–∞–∑–∫–∞ —Å–≤–µ—Ä—Ö—É (–º–æ–∂–Ω–æ —É–±—Ä–∞—Ç—å –ø—Ä–∏ –∂–µ–ª–∞–Ω–∏–∏) */
    .hint-bar {
      position: absolute;
      top: 8px;
      left: 50%;
      transform: translateX(-50%);
      padding: 6px 14px;
      border-radius: 999px;
      background: rgba(0,0,0,0.5);
      font-size: 14px;
      z-index: 5;
    }

    /* –ó–æ–Ω–∞ —Ä–µ–ª—å—Å –∏ –ø–∞—Ä–æ–≤–æ–∑–∞ (—Ü–µ–Ω—Ç—Ä –ø–æ –≤—ã—Å–æ—Ç–µ) */
    .rails-zone {
      position: absolute;
      left: 5%;
      right: 5%;
      top: 40%;
      height: 22%;
      /* –†–µ–ª—å—Å—ã –æ–±—ã—á–Ω–æ –±—É–¥—É—Ç –Ω–∞ —Ñ–æ–Ω–µ, —Ç—É—Ç –ø—Ä–æ—Å—Ç–æ –∑–æ–Ω–∞ –¥–ª—è —Å–ª–æ—Ç–æ–≤ */
    }

    /* –ü–∞—Ä–æ–≤–æ–∑ —Å–ø–µ—Ä–µ–¥–∏ —Å–ª–µ–≤–∞ */
    #train {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 18%;
      height: 80%;
      background-size: contain;
      background-position: center bottom;
      background-repeat: no-repeat;
      z-index: 3;
    }

    /* –û–±–ª–∞–∫–æ-–¥–∏–∞–ª–æ–≥ –Ω–∞–¥ –ø–∞—Ä–æ–≤–æ–∑–æ–º */
    .speech-bubble {
      position: absolute;
      bottom: 120px;
      left: 2%;
      transform: none;
      max-width: 260px;
      padding: 10px 14px;
      background: rgba(255,255,255,0.9);
      color: #222;
      border-radius: 16px;
      font-size: 14px;
      line-height: 1.3;
      z-index: 6;
    }

    .speech-bubble::after {
      content: "";
      position: absolute;
      bottom: -10px;
      left: 25px;
      border-width: 10px 10px 0 10px;
      border-style: solid;
      border-color: rgba(255,255,255,0.9) transparent transparent transparent;
    }

    /* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–ª–æ—Ç–æ–≤ –∑–∞ –ø–∞—Ä–æ–≤–æ–∑–æ–º */
    .slots-row {
      position: absolute;
      left: 14%;
      right: 0;
      bottom: 8%;
      height: 60%;
      display: flex;
      align-items: flex-end;
      justify-content: space-between;
      padding: 0 2%;
      z-index: 1;
    }

    .slot {
      position: relative;
      width: 8%;
      height: 55%;
      border-radius: 8px;
      border: 2px dashed rgba(255,255,255,0.25);
      background: rgba(0,0,0,0.15);
      transition: background 0.2s, border-color 0.2s, transform 0.2s;
    }

    .slot.correct {
      border-color: rgba(0,255,127,0.9);
      background: rgba(0,0,0,0.35);
      transform: scale(1.05);
    }

    .slot-number {
      position: absolute;
      bottom: -20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 14px;
      color: #fff;
      text-shadow: 0 0 3px rgba(0,0,0,0.7);
    }

    /* –í–∞–≥–æ–Ω—ã */
    .wagon {
      position: absolute;
      width: 130px;
      height: 90px;
      border-radius: 10px;
      background: linear-gradient(135deg, #ffb347, #ff7747);
      box-shadow: 0 4px 10px rgba(0,0,0,0.45);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 22px;
      color: #fff;
      text-shadow: 0 2px 4px rgba(0,0,0,0.8);
      cursor: grab;
      z-index: 4;
      transition: box-shadow 0.15s, transform 0.1s;
      /* TODO: —Å—é–¥–∞ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Ñ–æ–Ω-–≤–∞–≥–æ–Ω PNG
         background-image: url("WAGON_1.png");
         background-size: contain;
         background-position: center;
         background-repeat: no-repeat;
         (–Ω–æ–º–µ—Ä —Ç–æ–≥–¥–∞ –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –∏–ª–∏ —É–±—Ä–∞—Ç—å)
      */
        touch-action: none;
    }

    .wagon:active {
      cursor: grabbing;
      transform: scale(1.05);
      box-shadow: 0 6px 14px rgba(0,0,0,0.6);
    }

    .wagon.locked {
      cursor: default;
      box-shadow: 0 3px 8px rgba(0,0,0,0.5);
      transform: none !important;
    }

    /* –û–≤–µ—Ä–ª–µ–π —Å –≤–∏–¥–µ–æ */
    .video-overlay {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.85);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 20;
    }

    .video-overlay.active {
      display: flex;
    }

    .video-wrapper {
      width: 70%;
      max-width: 800px;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 0 30px rgba(0,0,0,0.9);
      background: #000;
      position: relative;
    }

    #winVideo {
      width: 100%;
      display: block;
    }

    /* –≠–∫—Ä–∞–Ω –ø–æ–±–µ–¥—ã */
    .win-overlay {
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at center, rgba(0,0,0,0.2), rgba(0,0,0,0.8));
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 15;
    }

    .win-overlay.active {
      display: flex;
    }

    .win-title {
      font-size: 64px;
      font-weight: 900;
      letter-spacing: 3px;
      margin-bottom: 16px;
      text-transform: uppercase;
      animation: pop 0.8s ease-out, glow 1.4s ease-in-out infinite alternate;
    }

    .win-subtitle {
      font-size: 20px;
      margin-bottom: 28px;
      opacity: 0.9;
    }

    .btn-restart {
      padding: 12px 26px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 18px;
      font-weight: 600;
      background: linear-gradient(135deg, #00d084, #00b894);
      color: #fff;
      box-shadow: 0 4px 12px rgba(0,0,0,0.6);
      transition: transform 0.15s, box-shadow 0.15s;
    }

    .btn-restart:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.7);
    }

    .btn-restart:active {
      transform: translateY(0);
      box-shadow: 0 3px 10px rgba(0,0,0,0.6);
    }

    /* –ü—Ä–æ—Å—Ç–µ–π—à–∏–π —Å–∞–ª—é—Ç */
    .firework {
      position: absolute;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: #fff;
      pointer-events: none;
      z-index: 30;
      box-shadow:
        0 0 0 0 rgba(255,255,255,0.9),
        0 0 0 0 rgba(255,255,0,0.9),
        0 0 0 0 rgba(0,255,255,0.9),
        0 0 0 0 rgba(255,0,255,0.9);
      animation: boom 0.8s ease-out forwards;
    }

    @keyframes boom {
      0% {
        transform: translate(-50%, -50%) scale(0.4);
        opacity: 1;
        box-shadow:
          0 0 0 0 rgba(255,255,255,0.9),
          0 0 0 0 rgba(255,255,0,0.9),
          0 0 0 0 rgba(0,255,255,0.9),
          0 0 0 0 rgba(255,0,255,0.9);
      }
      100% {
        transform: translate(-50%, -50%) scale(1.5);
        opacity: 0;
        box-shadow:
          0 -40px 0 0 rgba(255,255,255,0),
          35px -20px 0 0 rgba(255,255,0,0),
          -35px -20px 0 0 rgba(0,255,255,0),
          0 40px 0 0 rgba(255,0,255,0);
      }
    }

    @keyframes pop {
      0% { transform: scale(0.6); opacity: 0; }
      60% { transform: scale(1.08); opacity: 1; }
      100% { transform: scale(1); }
    }

    @keyframes glow {
      0% { text-shadow: 0 0 10px rgba(255,255,255,0.4); }
      100% { text-shadow: 0 0 25px rgba(255,255,0,0.9); }
    }

    /* –ß—Ç–æ–±—ã –≤–∞–≥–æ–Ω—ã –Ω–µ –≤—ã–ª–µ–∑–∞–ª–∏ –∑–∞ –ø—Ä–µ–¥–µ–ª—ã */
    .game-area {
      overflow: hidden;
    }
  </style>
</head>
<body>
  <div class="game-wrapper">
    <div class="game-area" id="gameArea">
      <div class="hint-bar">
        –í–∞–≥–æ–Ω–¥–∞—Ä–¥—ã 1-–¥–µ–Ω 10-“ì–∞ –¥–µ–π—ñ–Ω –¥“±—Ä—ã—Å —Ä–µ—Ç–ø–µ–Ω “õ–æ–π—ã–ø –∫”©–º–µ–∫—Ç–µ—Å!
      </div>

      <div class="rails-zone" id="railsZone">
        <div id="train"></div>
        <div class="speech-bubble" id="speechBubble">
          –ö”©–º–µ–∫—Ç–µ—Å—ñ“£–¥–µ—Ä—à—ñ –±–∞–ª–∞–ª–∞—Ä, –≤–∞–≥–æ–Ω–¥–∞—Ä—ã–º –∂–∞–Ω-–∂–∞“õ“õ–∞ —à–∞—à—ã–ª—ã–ø –∫–µ—Ç—Ç—ñ...
        </div>

        <div class="slots-row" id="slotsRow">
          <!-- –°–ª–æ—Ç—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
        </div>
      </div>

      <!-- –í–∞–≥–æ–Ω—ã —Å–æ–∑–¥–∞—é—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º -->
      
      <!-- –û–≤–µ—Ä–ª–µ–π —Å –≤–∏–¥–µ–æ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏ -->
      <div class="video-overlay" id="videoOverlay">
        <div class="video-wrapper">
          <!-- TODO: –ø–æ—Å—Ç–∞–≤—å —Å—é–¥–∞ —Å–≤–æ—ë –≤–∏–¥–µ–æ (–ø—Ä–∏–º–µ—Ä–Ω–æ 8 —Å–µ–∫—É–Ω–¥),
               –º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å controls –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ –Ω—É–∂–Ω—ã -->
          <video id="winVideo" preload="auto">
            <source src="https://files.catbox.moe/b3j3rh.mp4" type="video/mp4" />
            –ë—Ä–∞—É–∑–µ—Ä –≤–∏–¥–µ–æ–Ω—ã “õ–æ–ª–¥–∞–º–∞–π–¥—ã.
          </video>
        </div>
      </div>

      <!-- –≠–∫—Ä–∞–Ω –ø–æ–±–µ–¥—ã -->
      <div class="win-overlay" id="winOverlay">
        <div class="win-title">–ñ–µ“£—ñ—Å!!!</div>
        <div class="win-subtitle">–ü–∞—Ä–æ–≤–æ–∑–∏–∫–∫–µ –±–∞—Ä–ª—ã“õ –≤–∞–≥–æ–Ω–¥—ã —Ç–∞—É—ã–ø –±–µ—Ä–¥—ñ–∫!</div>
        <button class="btn-restart" id="restartBtn">–ë–∞—Å—ã–Ω–∞–Ω –±–∞—Å—Ç–∞—É</button>
      </div>
    </div>
  </div>

  <script>
    (function() {
      const NUM_WAGONS = 10;
      const wagonSize = { width: 130, height: 90 };
      const wagons = [];
      const slots = [];
      
      let placedCount = 0;
      let dragging = null;
      let offsetX = 0;
      let offsetY = 0;
      let activePointerId = null; // <- –¥–æ–±–∞–≤–∏–ª–∏

      const gameArea = document.getElementById('gameArea');
      const railsZone = document.getElementById('railsZone');
      const slotsRow = document.getElementById('slotsRow');
      const dingSound = document.getElementById('dingSound');
      const videoOverlay = document.getElementById('videoOverlay');
      const winVideo = document.getElementById('winVideo');
      const winOverlay = document.getElementById('winOverlay');
      const restartBtn = document.getElementById('restartBtn');
      const speechBubble = document.getElementById('speechBubble');
      const trainEl = document.getElementById('train');
      // üëâ —Å–ø–∏—Å–æ–∫ —Ç–≤–æ–∏—Ö PNG/WEBP-—Ñ–∞–π–ª–æ–≤ –≤–∞–≥–æ–Ω–æ–≤ –ø–æ –ø–æ—Ä—è–¥–∫—É
      const WAGON_IMAGES = [
        "https://files.catbox.moe/l78t16.webp", // –≤–∞–≥–æ–Ω 1
        "https://files.catbox.moe/yoybqd.webp", // –≤–∞–≥–æ–Ω 2
        "https://files.catbox.moe/la1qyh.webp", // –≤–∞–≥–æ–Ω 3
        "https://files.catbox.moe/0qhy8l.webp",
        "https://files.catbox.moe/55pjt1.webp",
        "https://files.catbox.moe/z4mwol.webp",
        "https://files.catbox.moe/ax2rxt.webp",
        "https://files.catbox.moe/v56fgr.webp",
        "https://files.catbox.moe/u0ph99.webp",
        "https://files.catbox.moe/6sfsp0.webp"  // –≤–∞–≥–æ–Ω 10
      ];
      const TRAIN_SAD = "https://files.catbox.moe/0mv7b7.webp";
      const TRAIN_HAPPY = "https://files.catbox.moe/db5b6h.webp";


      // –°–æ–∑–¥–∞—ë–º —Å–ª–æ—Ç—ã –∏ –ø–æ–¥–ø–∏—Å–∏
      function createSlots() {
        slotsRow.innerHTML = "";
        slots.length = 0;
        for (let i = 1; i <= NUM_WAGONS; i++) {
          const slot = document.createElement('div');
          slot.className = 'slot';
          slot.dataset.number = i;

          const label = document.createElement('div');
          label.className = 'slot-number';
          label.textContent = i;

          slot.appendChild(label);
          slotsRow.appendChild(slot);
          slots.push(slot);
        }
      }

      // –°–æ–∑–¥–∞—ë–º –≤–∞–≥–æ–Ω—ã
      function createWagons() {
        // —É–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ
        for (const w of wagons) {
          if (w.element && w.element.parentNode) {
            w.element.parentNode.removeChild(w.element);
          }
        }
        wagons.length = 0;

        for (let i = 1; i <= NUM_WAGONS; i++) {
          const wagonEl = document.createElement('div');
          wagonEl.className = 'wagon';
          wagonEl.dataset.number = i;
          wagonEl.dataset.locked = "false";
          
          // üëâ —Å—Ç–∞–≤–∏–º PNG –∫–∞–∫ —Ñ–æ–Ω
          wagonEl.style.backgroundImage = `url("${WAGON_IMAGES[i - 1]}")`;
          wagonEl.style.backgroundSize = "contain";
          wagonEl.style.backgroundRepeat = "no-repeat";
          wagonEl.style.backgroundPosition = "center";


          gameArea.appendChild(wagonEl);
          wagons.push({ number: i, element: wagonEl });
        }
      }

      // –†–∞–Ω–¥–æ–º–Ω—ã–µ –ø–æ–∑–∏—Ü–∏–∏ –≤–∞–≥–æ–Ω–æ–≤ (—Å–≤–µ—Ä—Ö—É –∏ —Å–Ω–∏–∑—É, –ù–ï –ø–æ —Ü–µ–Ω—Ç—Ä—É, –≥–¥–µ —Ä–µ–ª—å—Å—ã)
      function randomizeWagonPositions() {
        const areaRect = gameArea.getBoundingClientRect();
        const railsRect = railsZone.getBoundingClientRect();
        const bubble = document.getElementById('speechBubble');
        const bubbleRect = bubble ? bubble.getBoundingClientRect() : null;
      
        const margin = 10;
      
        wagons.forEach(w => {
          const el = w.element;
          el.classList.remove('locked');
          el.dataset.locked = "false";
      
          const placeOnTop = Math.random() < 0.5;
          let x, y;
      
          const minX = areaRect.left + margin;
          const maxX = areaRect.right - margin - wagonSize.width;
      
          if (placeOnTop) {
            // –≤–µ—Ä—Ö–Ω—è—è –∑–æ–Ω–∞, –Ω–æ –Ω–µ –∑–∞–ª–µ–∑–∞–µ–º –Ω–∞ –¥–∏–∞–ª–æ–≥–æ–≤–æ–µ –æ–∫–Ω–æ
            let minY = areaRect.top + margin;
            let maxY = railsRect.top - margin - wagonSize.height;
      
            if (bubbleRect) {
              // –ø—Ä–æ–±—É–µ–º –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –≤–µ—Ä—Ö —Ç–∞–∫, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ—Å–µ—á—å—Å—è —Å –ø—É–∑—ã—Ä—ë–º
              const candidateMaxY = bubbleRect.top - margin - wagonSize.height;
              if (candidateMaxY > minY) {
                maxY = candidateMaxY;
              }
            }
      
            if (maxY < minY) {
              // –µ—Å–ª–∏ –≤–¥—Ä—É–≥ –º–µ—Å—Ç–∞ –ø–æ—á—Ç–∏ –Ω–µ—Ç ‚Äî –æ—Ç–∫–∞—Ç—ã–≤–∞–µ–º—Å—è –∫ —Å—Ç–∞—Ä–æ–π –ª–æ–≥–∏–∫–µ
              maxY = railsRect.top - margin - wagonSize.height;
            }
      
            y = randomBetween(minY, maxY);
          } else {
            // –Ω–∏–∂–Ω—è—è –∑–æ–Ω–∞ –∫–∞–∫ —Ä–∞–Ω—å—à–µ
            const minY = railsRect.bottom + margin;
            let maxY = areaRect.bottom - margin - wagonSize.height;
      
            if (maxY < minY) {
              maxY = minY;
            }
      
            y = randomBetween(minY, maxY);
          }
      
          x = randomBetween(minX, maxX);
      
          const gameRect = gameArea.getBoundingClientRect();
          el.style.left = (x - gameRect.left) + "px";
          el.style.top = (y - gameRect.top) + "px";
        });
      }


      function randomBetween(min, max) {
        if (max < min) max = min;
        return Math.random() * (max - min) + min;
      }

      // Drag & drop (–º—ã—à—å + —Ç–∞—á)
      function initDragging() {
        // –°–ª—É—à–∞–µ–º –≤—Å—ë –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
        gameArea.addEventListener('pointerdown', onPointerDown);
        gameArea.addEventListener('pointermove', onPointerMove);
        gameArea.addEventListener('pointerup', onPointerUp);
        gameArea.addEventListener('pointercancel', onPointerUp);
      }


      function onPointerDown(e) {
        const target = e.target.closest('.wagon');
        if (!target) return;
        if (target.dataset.locked === "true") return;
      
        e.preventDefault(); // –Ω–µ –¥–∞—ë–º —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–∫—Ä–æ–ª–ª–∏—Ç—å—Å—è/–∑—É–º–∏—Ç—å
      
        dragging = target;
        activePointerId = e.pointerId;
      
        const rect = dragging.getBoundingClientRect();
        offsetX = e.clientX - rect.left;
        offsetY = e.clientY - rect.top;
      
        dragging.style.zIndex = 10;
      
        // –∑–∞—Ö–≤–∞—Ç—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è —ç—Ç–æ–≥–æ –ø–∞–ª—å—Ü–∞/—Å—Ç–∏–ª—É—Å–∞
        if (dragging.setPointerCapture) {
          dragging.setPointerCapture(activePointerId);
        }
      }
      
      
      function onPointerMove(e) {
        if (!dragging) return;
        if (e.pointerId !== activePointerId) return;
      
        e.preventDefault(); // –±–ª–æ–∫–∏—Ä—É–µ–º —Å–∫—Ä–æ–ª–ª –ø—Ä–∏ –¥–≤–∏–∂–µ–Ω–∏–∏
      
        const areaRect = gameArea.getBoundingClientRect();
      
        let newLeft = e.clientX - areaRect.left - offsetX;
        let newTop = e.clientY - areaRect.top - offsetY;
      
        // –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –≤–Ω—É—Ç—Ä–∏ –ø–æ–ª—è
        newLeft = Math.max(0, Math.min(areaRect.width - dragging.offsetWidth, newLeft));
        newTop = Math.max(0, Math.min(areaRect.height - dragging.offsetHeight, newTop));
      
        dragging.style.left = newLeft + "px";
        dragging.style.top = newTop + "px";
      }

      
      function onPointerUp(e) {
        if (!dragging) return;
        if (e.pointerId !== activePointerId) return;
      
        e.preventDefault();
      
        if (dragging.releasePointerCapture) {
          try {
            dragging.releasePointerCapture(activePointerId);
          } catch (err) {
            // –∏–Ω–æ–≥–¥–∞ –±—Ä–æ—Å–∞–µ—Ç –æ—à–∏–±–∫—É, –ø—Ä–æ—Å—Ç–æ –∏–≥–Ω–æ—Ä–∏–º
          }
        }
      
        const wagon = dragging;
        activePointerId = null;
      
        const wagonNumber = parseInt(wagon.dataset.number, 10);
      
        let snapped = false;
        const wagonRect = wagon.getBoundingClientRect();
      
        for (const slot of slots) {
          const slotNumber = parseInt(slot.dataset.number, 10);
          if (slotNumber !== wagonNumber) continue;
      
          const slotRect = slot.getBoundingClientRect();
      
          const wagonCenter = {
            x: wagonRect.left + wagonRect.width / 2,
            y: wagonRect.top + wagonRect.height / 2
          };
          const slotCenter = {
            x: slotRect.left + slotRect.width / 2,
            y: slotRect.top + slotRect.height / 2
          };
      
          const dx = wagonCenter.x - slotCenter.x;
          const dy = wagonCenter.y - slotCenter.y;
          const distance = Math.sqrt(dx * dx + dy * dy);
      
          const snapRadius = Math.min(slotRect.width, slotRect.height) * 0.8;
      
          if (distance < snapRadius) {
            const areaRect = gameArea.getBoundingClientRect();
            const left = slotCenter.x - areaRect.left - wagonRect.width / 2;
            const top = slotCenter.y - areaRect.top - wagonRect.height / 2;
      
            wagon.style.left = left + "px";
            wagon.style.top = top + "px";
            wagon.dataset.locked = "true";
            wagon.classList.add('locked');
            slot.classList.add('correct');
            snapped = true;
      
            placedCount++;
            playDing();
            spawnFirework(
              slotCenter.x - areaRect.left,
              slotCenter.y - areaRect.top
            );
      
            if (placedCount === NUM_WAGONS) {
              onAllPlaced();
            }
      
            break;
          }
        }
      
        wagon.style.zIndex = 4;
        dragging = null;
      }

      function playDing() {
        if (!dingSound) return;
        try {
          dingSound.currentTime = 0;
          dingSound.play();
        } catch (e) {
          // –µ—Å–ª–∏ –±—Ä–∞—É–∑–µ—Ä –Ω–µ –¥–∞—ë—Ç –∞–≤—Ç–æ–ø–ª–µ–π
        }
      }

      function spawnFirework(x, y) {
        const fw = document.createElement('div');
        fw.className = 'firework';
        fw.style.left = x + "px";
        fw.style.top = y + "px";
        gameArea.appendChild(fw);

        setTimeout(() => {
          if (fw.parentNode) fw.parentNode.removeChild(fw);
        }, 900);
      }

      function onAllPlaced() {
        // –ø–∞—Ä–æ–≤–æ–∑ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–µ—Å–µ–ª—ã–º
        if (trainEl) {
          trainEl.style.backgroundImage = `url("${TRAIN_HAPPY}")`;
        }
        // —É–±–∏—Ä–∞–µ–º —Ñ—Ä–∞–∑—É –ø–æ–º–æ—â–∏, –æ–Ω —É–∂–µ –±–ª–∞–≥–æ–¥–∞—Ä–∏—Ç –≤ –≤–∏–¥–µ–æ
        if (speechBubble) {
          speechBubble.style.display = 'none';
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∏–¥–µ–æ
        videoOverlay.classList.add('active');

        if (winVideo) {
          try {
            winVideo.currentTime = 0;
            winVideo.play();
          } catch (e) {
            // –µ—Å–ª–∏ –∞–≤—Ç–æ–ø–ª–µ–π –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω ‚Äì –æ–∫, —é–∑–µ—Ä —Å–∞–º –∑–∞–ø—É—Å—Ç–∏—Ç
          }

          winVideo.onended = function() {
            videoOverlay.classList.remove('active');
            showWinOverlay();
          };
        } else {
          // –Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –≤–∏–¥–µ–æ –Ω–µ—Ç ‚Äì –ø—Ä–æ—Å—Ç–æ —Å—Ä–∞–∑—É –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–±–µ–¥—É
          showWinOverlay();
        }
      }

      function showWinOverlay() {
        winOverlay.classList.add('active');
      
        // –ø–æ–±–µ–¥–Ω—ã–π –∑–≤—É–∫
        const ws = document.getElementById('winSound');
        if (ws) {
          ws.currentTime = 0;
          ws.play();
        }
      
        // –±–æ–Ω—É—Å: –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–∞–ª—é—Ç–æ–≤
        const areaRect = gameArea.getBoundingClientRect();
        for (let i = 0; i < 8; i++) {
          setTimeout(() => {
            const x = randomBetween(areaRect.width * 0.15, areaRect.width * 0.85);
            const y = randomBetween(areaRect.height * 0.15, areaRect.height * 0.6);
            spawnFirework(x, y);
          }, i * 180);
        }
      }


      function resetGame() {
        placedCount = 0;
        winOverlay.classList.remove('active');
      
        slots.forEach(slot => slot.classList.remove('correct'));
      
        if (speechBubble) {
          speechBubble.style.display = '';
        }
      
        // —Å–Ω–æ–≤–∞ –≥—Ä—É—Å—Ç–Ω—ã–π
        if (trainEl) {
          trainEl.style.backgroundImage = `url("${TRAIN_SAD}")`;
        }
      
        randomizeWagonPositions();
      }


      // –ö–Ω–æ–ø–∫–∞ "–ë–∞—Å—ã–Ω–∞–Ω –±–∞—Å—Ç–∞—É"
      restartBtn.addEventListener('click', resetGame);

      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
      window.addEventListener('load', () => {
        createSlots();
        createWagons();
        randomizeWagonPositions();
        initDragging();
      
        if (trainEl) {
          trainEl.style.backgroundImage = `url("${TRAIN_SAD}")`;
        }
      });


      // –ø—Ä–∏ —Ä–µ—Å–∞–π–∑–µ –æ–∫–Ω–∞ —Å–ª–µ–≥–∫–∞ –ø–æ–ø—Ä–∞–≤–∏–º –ø–æ–∑–∏—Ü–∏–∏ (—á—Ç–æ–± –¥–∞–ª—å—à–µ –Ω–µ –∂–∏–ª–æ —Å–æ–≤—Å–µ–º –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ)
      window.addEventListener('resize', () => {
        // –ø—Ä–æ—Å—Ç–æ —Ä–∞—Å–∫–∏–¥–∞–µ–º –∑–∞–Ω–æ–≤–æ
        randomizeWagonPositions();
      });
    })();
  </script>
</body>
</html>
